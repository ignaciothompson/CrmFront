<app-subheader 
  [filters]="subheaderFilters"
  [initialValues]="initialFilterValues"
  (submit)="onFilterSubmit($event)"
  [submitLabel]="'Aplicar'">
</app-subheader>

  <div class="frame">
    <div class="frame-title">
      <h4>Unidades ({{ filteredUnidades.length }})</h4>
      <div class="frame-actions">
      @if (selectedUnidades.size > 0) {
        <button (click)="clearSelection()" class="btn c-btn btn-default pull-end m-r-sm">Limpiar selección ({{ selectedUnidades.size }})</button>
      }
        <button (click)="goNuevo()" class="btn c-btn btn-primary pull-end">Nuevo</button>
      </div>
    </div>
    <div class="frame-body">
      <!-- Desktop Table View -->
      <div class="d-none d-md-block scroll-table">
        <table class="table c-table table-fixed table-striped">
          <thead>
            <tr>
            <th style="width: 40px;">
              <input 
                type="checkbox" 
                [checked]="isAllSelected()" 
                [indeterminate]="isIndeterminate()"
                (change)="toggleSelectAll($event)"
                aria-label="Seleccionar todas">
            </th>
              <th>Unidad</th>
              <th>Proyecto</th>
              <th>Localidad</th>
              <th>Tamaño</th>
              <th>Fecha entrega</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for (it of filteredUnidades; track it) {
              <tr>
              <td style="width: 40px;">
                <input 
                  type="checkbox" 
                  [checked]="isSelected(it.id)" 
                  (change)="toggleSelection(it.id, $event)"
                  (click)="$event.stopPropagation()"
                  aria-label="Seleccionar unidad">
              </td>
                <td>{{ it.nombre || it.name }}</td>
              <td>{{ getProyectoNombre(it) || '-' }}</td>
                <td>{{ labelForCity(it.city || it.localidad) }}</td>
                <td>{{ getPrimarySize(it) }}</td>
                <td>{{ it.entrega || it.fechaEntrega }}</td>
                <td class="text-end">
                  <a href="javascript:;" (click)="goEditar(it.id); $event.stopPropagation()" class="btn-table" aria-label="Editar"><i class="fas fa-pen"></i></a>
                  <a href="javascript:;" class="btn-table" aria-label="Visitar"><i class="fa fa-external-link"></i></a>
                  <a href="javascript:;" (click)="eliminar(it.id, $event)" class="btn-table eliminar" aria-label="Eliminar"><i class="fa fa-trash"></i></a>
                </td>
              </tr>
            }
            @if (!filteredUnidades.length) {
              <tr>
              <td colspan="7" class="text-center">Sin resultados</td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="clickable-cards-container d-md-none">
        @for (it of filteredUnidades; track it) {
          <div class="clickable-card" (click)="verUnidad(it)">
            <div class="clickable-card-header d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2">
              <input 
                type="checkbox" 
                [checked]="isSelected(it.id)" 
                (change)="toggleSelection(it.id, $event)"
                (click)="$event.stopPropagation()"
                aria-label="Seleccionar unidad">
              <span class="clickable-card-value highlight">{{ it.nombre || it.name }}</span>
            </div>
              <span class="d-flex align-items-center gap-2"> 
                <a href="javascript:;" (click)="goEditar(it.id); $event.stopPropagation()" class="btn-table" aria-label="Editar"><i class="fas fa-pen"></i></a>
                <a href="javascript:;" (click)="$event.stopPropagation()" class="btn-table" aria-label="Visitar"><i class="fa fa-external-link"></i></a>
                <a href="javascript:;" (click)="eliminar(it.id, $event)" class="btn-table eliminar" aria-label="Eliminar"><i class="fa fa-trash"></i></a>
              </span>
            </div>
            <div class="clickable-card-body">
              <div class="clickable-card-row">
                <div class="clickable-card-label">
                  <i class="fa fa-map-marker-alt"></i>
                  <span>Localidad</span>
                </div>
                <div class="clickable-card-value">{{ labelForCity(it.city || it.localidad) }}</div>
              </div>
              <div class="clickable-card-row">
                <div class="clickable-card-label">
                  <i class="fa fa-building"></i>
                  <span>Proyecto</span>
                </div>
              <div class="clickable-card-value">{{ getProyectoNombre(it) || '-' }}</div>
              </div>
              <div class="clickable-card-row">
                <div class="clickable-card-label">
                  <i class="fa fa-ruler"></i>
                  <span>Tamaño</span>
                </div>
                <div class="clickable-card-value">{{ getPrimarySize(it) || '-' }}</div>
              </div>
              <div class="clickable-card-row">
                <div class="clickable-card-label">
                  <i class="fa fa-calendar"></i>
                  <span>Fecha entrega</span>
                </div>
                <div class="clickable-card-value">{{ it.entrega || it.fechaEntrega || '-' }}</div>
              </div>
            </div>
            <div class="clickable-card-footer">
              <a href="javascript:;" (click)="goEditar(it.id); $event.stopPropagation()" class="btn-table" aria-label="Editar"><i class="fas fa-pen"></i></a>
              <a href="javascript:;" (click)="$event.stopPropagation()" class="btn-table" aria-label="Visitar"><i class="fa fa-external-link"></i></a>
              <a href="javascript:;" (click)="eliminar(it.id, $event)" class="btn-table eliminar" aria-label="Eliminar"><i class="fa fa-trash"></i></a>
            </div>
          </div>
        }
        @if (!filteredUnidades.length) {
          <div class="clickable-card-empty">
            <i class="fa fa-cube"></i>
            <p>Sin resultados</p>
          </div>
        }
      </div>
    </div>
  </div>

