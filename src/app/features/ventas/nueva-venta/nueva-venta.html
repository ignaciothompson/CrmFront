<div class="modal-header">
  <p>Nueva venta</p>
  <button type="button" aria-label="Close" (click)="activeModal.dismiss()"><i class="fas fa-times"></i></button>
</div>
<div class="modal-body">
  <div class="row">
    <div class="col-xs-12 col-sm-4 m-b">
      <label class="form-label"><b>Tipo</b></label>
      <select class="form-control c-input" [(ngModel)]="selectedType">
        <option value="venta">Venta</option>
        <option value="renta">Renta</option>
      </select>
    </div>
    <div class="col-xs-12 col-sm-4 m-b">
      <label class="form-label"><b>Contacto</b></label>
      <typeahead [(ngModel)]="selectedContactoId" name="selectedContactoId" [items]="contactoItems" idKey="id" labelKey="label" placeholder="Buscar contacto..."></typeahead>
    </div>
    <div class="col-xs-12 col-sm-4 m-b">
      <label class="form-label"><b>Unidad</b></label>
      <typeahead [(ngModel)]="selectedUnidadId" name="selectedUnidadId" [items]="unidadItems" idKey="id" labelKey="label" placeholder="Buscar unidad..." (ngModelChange)="onUnidadSelected()"></typeahead>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12 col-sm-4 m-b">
      <label class="form-label"><b>Importe (USD)</b></label>
      <input type="number" class="form-control c-input" [(ngModel)]="importe" name="importe" placeholder="0.00" step="0.01" min="0">
    </div>
    <div class="col-xs-12 col-sm-4 m-b">
      <label class="form-label"><b>Comisión (%)</b></label>
      <input type="number" class="form-control c-input" [(ngModel)]="comision" name="comision" placeholder="0.00" step="0.01" min="0" max="100">
    </div>
    @if (selectedType === 'renta') {
      <div class="col-xs-12 col-sm-4 m-b">
        <label class="form-label"><b>Meses</b></label>
        <input type="number" class="form-control c-input" [(ngModel)]="meses" name="meses" placeholder="0" step="1" min="1" required>
      </div>
    } @else {
      <div class="col-xs-12 col-sm-4 m-b"></div>
    }
    <div class="col-xs-12 col-sm-4 m-b text-end">
      <button class="btn c-btn btn-small btn-primary m-t-label" (click)="agregar()">Agregar</button>
    </div>
  </div>

  <div class="row m-t">
    <div class="col-xs-12">
      <p class="m-b-xs"><b>Ventas a guardar</b></p>
      <div class="table-responsive">
        <table class="table c-table table-striped">
          <thead>
            <tr>
              <th>Contacto</th>
              <th>Unidad</th>
              <th>Tipo</th>
              <th>Importe</th>
              <th>Comisión</th>
              <th>Meses</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (r of ventasAgregadas; track $index) {
              <tr>
                <td>{{ r?.contacto?.nombre || '-' }}</td>
                <td>{{ r?.unidad?.nombre || '-' }}</td>
                <td>{{ r?.type | titlecase }}</td>
                <td>{{ r?.importe ? (r.importe | currency:'USD':'symbol':'1.0-0') : '-' }}</td>
                <td>{{ r?.comision ? (r.comision + '%') : '-' }}</td>
                <td>{{ r?.type === 'renta' && r?.meses ? r.meses + ' meses' : '-' }}</td>
                <td class="text-end">
                  <button class="btn-table eliminar" title="Eliminar" (click)="eliminarDeLista($index)"><i class="fa fa-trash"></i></button>
                </td>
              </tr>
            }
            @if (!ventasAgregadas.length) {
              <tr><td colspan="7" class="text-center">No hay ventas agregadas</td></tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<div class="modal-footer">
  <button type="button" class="btn c-btn btn-small btn-default" (click)="activeModal.dismiss()">Cancelar</button>
  <button type="button" class="btn c-btn btn-small btn-primary" [disabled]="ventasAgregadas.length === 0" (click)="confirmar()">Guardar @if (ventasAgregadas.length > 0) { ({{ ventasAgregadas.length }}) }</button>
</div>
