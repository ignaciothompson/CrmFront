<app-subheader 
  [filters]="subheaderFilters"
  [initialValues]="initialFilterValues"
  (submit)="onFilterSubmit($event)"
  [submitLabel]="'Aplicar'">
</app-subheader>
<div class="row m-b-md">
	<div class="col-xs-12">
		<div class="frame">
			<div class="frame-title">
				<h4>Dinero Ganado</h4>
			</div>
			<div class="frame-body">
				<div class="row m-b-md">
					<div class="col-xs-12 col-sm-4">
						<div class="card info">
							<div class="card-icon">
								<i class="fa fa-dollar-sign"></i>
							</div>
							<div class="card-data">
								<div class="card-title">Total Ganado</div>
								<div class="card-value">{{ getTotalDineroGanado() | currency:'USD':'symbol':'1.0-0' }}</div>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-4">
						<div class="card success">
							<div class="card-icon">
								<i class="fa fa-handshake"></i>
							</div>
							<div class="card-data">
								<div class="card-title">Total Ventas</div>
								<div class="card-value">{{ getTotalVentas() }}</div>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-4">
						<div class="card warning">
							<div class="card-icon">
								<i class="fa fa-key"></i>
							</div>
							<div class="card-data">
								<div class="card-title">Total Rentas</div>
								<div class="card-value">{{ getTotalRentas() }}</div>
							</div>
						</div>
					</div>
				</div>
				<!-- Desktop Table View -->
				<div class="d-none d-md-block table-responsive">
					<table class="table c-table table-striped">
						<thead>
							<tr>
								<th>Fecha</th>
								<th>Contacto</th>
								<th>Unidad</th>
								<th>Tipo</th>
								<th>Importe</th>
								<th>Comisión %</th>
								<th>Total Comisión</th>
							</tr>
						</thead>
						<tbody>
							@for (v of filteredVentas; track v) {
								<tr>
									<td>{{ v.date | date:'short' }}</td>
									<td>{{ v?.contacto?.nombre || '-' }}</td>
									<td>{{ v?.unidad?.nombre || '-' }}</td>
									<td>{{ v?.type | titlecase }}</td>
									<td>{{ v?.importe ? (v.importe | currency:'USD':'symbol':'1.0-0') : '-' }}</td>
									<td>{{ v?.comision ? (v.comision + '%') : '-' }}</td>
									<td>
										@if (v?.importe && v?.comision) {
											{{ ((v.importe ?? 0) * (v.comision ?? 0) / 100) | currency:'USD':'symbol':'1.0-0' }}
										} @else {
											-
										}
									</td>
								</tr>
							}
							@if (!filteredVentas.length) {
								<tr><td colspan="7" class="text-center">Sin resultados</td></tr>
							}
						</tbody>
					</table>
				</div>
				<!-- Mobile Card View -->
				<div class="clickable-cards-container d-md-none">
					@for (v of filteredVentas; track v) {
						<div class="clickable-card">
							<div class="clickable-card-header">
								<div class="clickable-card-date">
									<i class="fa fa-calendar"></i>
									<span>{{ v.date | date:'short' }}</span>
								</div>
								<div class="clickable-card-badge" [ngClass]="v?.type === 'venta' ? 'badge-success' : 'badge-primary'">
									{{ v?.type | titlecase }}
								</div>
							</div>
							<div class="clickable-card-body">
								<div class="clickable-card-row">
									<div class="clickable-card-label">
										<i class="fa fa-user"></i>
										<span>Contacto</span>
									</div>
									<div class="clickable-card-value">{{ v?.contacto?.nombre || '-' }}</div>
								</div>
								<div class="clickable-card-row">
									<div class="clickable-card-label">
										<i class="fa fa-building"></i>
										<span>Unidad</span>
									</div>
									<div class="clickable-card-value">{{ v?.unidad?.nombre || '-' }}</div>
								</div>
								<div class="clickable-card-row">
									<div class="clickable-card-label">
										<i class="fa fa-dollar-sign"></i>
										<span>Importe</span>
									</div>
									<div class="clickable-card-value highlight">
										{{ v?.importe ? (v.importe | currency:'USD':'symbol':'1.0-0') : '-' }}
									</div>
								</div>
								<div class="clickable-card-row">
									<div class="clickable-card-label">
										<i class="fa fa-percent"></i>
										<span>Comisión</span>
									</div>
									<div class="clickable-card-value">
										@if (v?.importe && v?.comision) {
											{{ ((v.importe ?? 0) * (v.comision ?? 0) / 100) | currency:'USD':'symbol':'1.0-0' }}
											<small class="text-muted">({{ v.comision }}%)</small>
										} @else {
											-
										}
									</div>
								</div>
							</div>
						</div>
					}
					@if (!filteredVentas.length) {
						<div class="clickable-card-empty">
							<i class="fa fa-chart-line"></i>
							<p>Sin resultados</p>
						</div>
					}
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-xs-12">
		<div class="frame m-b-md">
			<div class="frame-body">
				<h5>
					Unidades registradas vs vendidas
					<span class="frame-actions segmented">
						<button class="btn c-btn btn-small btn-white" [class.active]="unidadesGroupMode==='month'" (click)="setUnidadesGroupMode('month')">Mes</button>
						<button class="btn c-btn btn-small btn-white" [class.active]="unidadesGroupMode==='week'" (click)="setUnidadesGroupMode('week')">Semana</button>
						<button class="btn c-btn btn-small btn-white" [class.active]="unidadesGroupMode==='day'" (click)="setUnidadesGroupMode('day')">Día</button>
					</span>
				</h5>
				<div class="chart-fill" id="chartMain" #chartMain>
					<canvas baseChart
						[type]="'line'"
						[data]="lineData"
						[options]="lineOptions">
					</canvas>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 col-sm-6">
		<div class="frame">
			<div class="frame-body">
				<h5>
					Entrevistas por {{ entrevistasXAxisLabel }}
					<span class="frame-actions segmented">
						<button class="btn c-btn btn-small btn-white" [class.active]="entrevistasGroupMode==='month'" (click)="setEntrevistasGroupMode('month')">Mes</button>
						<button class="btn c-btn btn-small btn-white" [class.active]="entrevistasGroupMode==='week'" (click)="setEntrevistasGroupMode('week')">Semana</button>
						<button class="btn c-btn btn-small btn-white" [class.active]="entrevistasGroupMode==='day'" (click)="setEntrevistasGroupMode('day')">Día</button>
					</span>
				</h5>
				<div class="chart-fill" id="chartBars" #chartBars>
					<canvas baseChart
						[type]="'bar'"
						[data]="barData"
						[options]="barOptions">
					</canvas>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-12 col-sm-6">
		<div class="frame ">
			<div class="frame-body">
				<h5 style="height: 32px;">Unidades por ciudad</h5>
				<div class="chart-fill" id="chartPie" #chartPie>
					<canvas baseChart
						[type]="'doughnut'"
						[data]="pieData"
						[options]="pieOptions">
					</canvas>
				</div>
			</div>
		</div>
	</div>
</div>

